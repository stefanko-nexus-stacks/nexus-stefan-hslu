# =============================================================================
# SeaweedFS - Distributed S3-Compatible Object Storage
# =============================================================================
# Lightweight distributed object storage with S3 API
#
# URLs:
#   - https://seaweedfs.<domain>         -> Filer Web UI (file browser/upload)
#   - https://seaweedfs-manager.<domain> -> Master UI (cluster statistics)
#   - S3 API: Port 8333 (internal, use S3-compatible tools)
#
# Default credentials:
#   Access Key: ${SEAWEEDFS_ACCESS_KEY}
#   Secret Key: Generated by OpenTofu (stored in Infisical)
#
# Documentation: https://github.com/seaweedfs/seaweedfs/wiki
# =============================================================================

services:
  seaweedfs:
    image: ${IMAGE_SEAWEEDFS:-chrislusf/seaweedfs:3.82}
    container_name: seaweedfs
    restart: unless-stopped
    ports:
      - "9333:9333"  # Master UI (statistics only)
      - "8333:8333"  # S3 API
      - "8888:8888"  # Filer Web UI (file browser/upload)
    command: >
      server
      -s3
      -s3.port=8333
      -s3.config=/etc/seaweedfs/s3.json
      -master.port=9333
      -volume.port=18080
      -filer
      -filer.port=8888
      -dir=/data
    volumes:
      - seaweedfs_data:/data
      - ./s3.json:/etc/seaweedfs/s3.json:ro
    networks:
      - app-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9333/cluster/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

volumes:
  seaweedfs_data:

networks:
  app-network:
    external: true
