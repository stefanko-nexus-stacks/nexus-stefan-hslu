# =============================================================================
# RustFS - Rust-based S3-Compatible Object Storage
# =============================================================================
# High-performance MinIO alternative written in Rust
# Accessible via: https://rustfs.<domain>
#
# Port: 9002 (Console), 9003 (S3 API) - mapped to avoid MinIO conflicts
#
# Default credentials:
#   Access Key: ${RUSTFS_ACCESS_KEY}
#   Secret Key: Generated by OpenTofu (stored in Infisical)
#
# Documentation: https://docs.rustfs.com
# =============================================================================

services:
  rustfs:
    image: ${IMAGE_RUSTFS:-rustfs/rustfs:1.0.0-alpha.82}
    container_name: rustfs
    restart: unless-stopped
    user: "10001:10001"
    ports:
      - "9002:9001"  # Web Console (host 9002 -> container 9001)
      - "9003:9000"  # S3 API (host 9003 -> container 9000)
    env_file: .env
    environment:
      # RustFS uses RUSTFS_ACCESS_KEY/SECRET_KEY (not ROOT_USER/PASSWORD)
      RUSTFS_ACCESS_KEY: ${RUSTFS_ACCESS_KEY:-rustfs}
      RUSTFS_SECRET_KEY: ${RUSTFS_SECRET_KEY}
      RUSTFS_ADDRESS: ":9000"
      RUSTFS_CONSOLE_ENABLE: "true"
    command: /data
    volumes:
      - rustfs_data:/data
    networks:
      - app-network
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://127.0.0.1:9000/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  rustfs_data:

networks:
  app-network:
    external: true
